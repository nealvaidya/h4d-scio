<!doctype html>
<html>
<head>
   <script
   src="https://code.jquery.com/jquery-3.3.1.min.js"
   integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
   crossorigin="anonymous"></script>
   <script src="https://d3js.org/d3.v5.min.js"></script>
   <script src="https://unpkg.com/billboard.js/dist/billboard.min.js" type="text/javascript"></script>
   <style>
      .line {
         fill: none;
         stroke: #ffab00;
         stroke-width: 3;
      }
      .btn-block {
         margin-top: 5px;
         margin-bottom: 5px;
      }
      .container {
         margin-top: 20px;
      }
   </style>
   <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
   <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>
<body>
   <div class="container">
      <div class = "row">
         <h1>  
            <a class="btn btn-outline-secondary" href="/" role="button">
               <i class="fas fa-arrow-left"></i>
            </a>
            {{ keyword }} 
         </h1>
      </div>
      <div class="row">
         <div class="col-4" id="similar-words">
            <h2>Similar Words:</h2>
         </div>
         <div class="col-8" id="frequency-graph"></div>
      </div>
   </div>
   <script>
      
      var freqs = {{ freqs|safe }};
      var sims = {{similars|tojson}};
      
      /**
      * sends a request to the specified url from a form. this will change the window location.
      * @param {string} path the path to send the post request to
      * @param {object} params the paramiters to add to the url
      * @param {string} [method=post] the method to use on the form
      */
      
      function post(path, params, method) {
         method = method || "post"; // Set method to post by default if not specified.
         
         // The rest of this code assumes you are not using a library.
         // It can be made less wordy if you use one.
         var form = document.createElement("form");
         form.setAttribute("method", method);
         form.setAttribute("action", path);
         
         for(var key in params) {
            if(params.hasOwnProperty(key)) {
               var hiddenField = document.createElement("input");
               hiddenField.setAttribute("type", "hidden");
               hiddenField.setAttribute("name", key);
               hiddenField.setAttribute("value", params[key]);
               
               form.appendChild(hiddenField);
            }
         }
         
         document.body.appendChild(form);
         form.submit();
      }
      d3.select('#similar-words')
      .selectAll('button')
      .data(sims).enter()
      .append("div")
      .attr("class","row")
      .append('button')
      .attr("type", "button")
      .attr("class", "btn btn-primary btn-block")
      .text(function(d) {return d})
      .on("click", function(d){
         post("{{ url_for('my_form_post') }}", {keyword: d})
      });
      
      bbox = d3.select('#frequency-graph').node().getBoundingClientRect()
      var margin = {top: 50, right: 50, bottom: 25, left: 50};
      var svgwidth = bbox.width;
      var svgheight = bbox.height;
      
      var width = svgwidth - margin.left - margin.right;
      var height = svgheight - margin.top - margin.bottom;
      
      var parseDate = d3.timeParse("%Y-%m-%d");
      
      var x = d3.scaleTime()
      .domain([new Date(2016, 0, 1), new Date(2016,4,12)])
      .range([0, width]);

      var y = d3.scaleLinear()
      .domain([0, d3.max(freqs.map( function(x) {return x.freq} ))])
      .range([height, 0])

      var Line = d3.line()
      .x(function(d) { return x(parseDate(d.date)); })
      .y(function(d) { return y(d.freq); });

      var svg = d3.select('#frequency-graph')
      .append('svg')
      .attr('width', svgwidth)
      .attr('height', svgheight)
      .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
      
      svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x));
      svg.append("g")
      .attr("class", "y axis")
      .call(d3.axisLeft(y));
      
      svg.append('path')
      .datum(freqs)
      .attr("class","line")
      .attr("d", Line)
      
   </script>
</body>
</html>